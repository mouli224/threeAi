<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hugging Face Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a2e; color: white; }
        .container { max-width: 800px; margin: 0 auto; }
        button { background: #4CAF50; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #45a049; }
        .result { margin: 10px 0; padding: 15px; border-radius: 5px; white-space: pre-wrap; font-family: monospace; }
        .info { background: rgba(33, 150, 243, 0.2); }
        .success { background: rgba(76, 175, 80, 0.2); }
        .error { background: rgba(244, 67, 54, 0.2); }
        .warning { background: rgba(255, 193, 7, 0.2); }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêõ Hugging Face Debug Center</h1>
        
        <h2>Step 1: Token Validation</h2>
        <button onclick="testToken()">Test Token with /whoami</button>
        <div id="token-result" class="result info">Click to test your token...</div>
        
        <h2>Step 2: API Endpoints</h2>
        <button onclick="testShapeE()">Test Shap-E</button>
        <button onclick="testPointE()">Test Point-E</button>
        <button onclick="testStableDiffusion()">Test Stable Diffusion</button>
        <div id="api-result" class="result info">Click to test API endpoints...</div>
        
        <h2>Step 3: Model Status</h2>
        <button onclick="checkModelStatus()">Check Model Status</button>
        <div id="status-result" class="result info">Click to check model availability...</div>
        
        <h2>Step 4: Generate Test</h2>
        <button onclick="testGeneration()">Test Simple Generation</button>
        <div id="generation-result" class="result info">Click to test generation...</div>
        
        <h2>Step 5: CORS Test</h2>
        <button onclick="testCORS()">Test CORS Policy</button>
        <div id="cors-result" class="result info">Click to test CORS...</div>
    </div>

    <script>
        const TOKEN = 'YOUR_HUGGINGFACE_TOKEN';
        
        function updateResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
        }
        
        async function testToken() {
            updateResult('token-result', 'Testing token with Hugging Face /whoami endpoint...', 'info');
            
            try {
                // Try CORS proxy first
                let response;
                let endpoint = 'https://cors-anywhere.herokuapp.com/https://huggingface.co/api/whoami';
                
                try {
                    response = await fetch(endpoint, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${TOKEN}`,
                            'Content-Type': 'application/json',
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });
                } catch (corsError) {
                    // Fallback to direct call (might be blocked by CORS)
                    updateResult('token-result', 'CORS proxy failed, trying direct call...', 'warning');
                    endpoint = 'https://huggingface.co/api/whoami';
                    response = await fetch(endpoint, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${TOKEN}`,
                            'Content-Type': 'application/json'
                        }
                    });
                }
                
                const responseText = await response.text();
                
                if (response.ok) {
                    try {
                        const data = JSON.parse(responseText);
                        updateResult('token-result', 
                            `‚úÖ Token is valid!\n\nUser Info:\n${JSON.stringify(data, null, 2)}`, 
                            'success'
                        );
                    } catch (e) {
                        updateResult('token-result', 
                            `‚úÖ Token valid but response parsing failed:\n${responseText}`, 
                            'warning'
                        );
                    }
                } else {
                    updateResult('token-result', 
                        `‚ùå Token validation failed!\nStatus: ${response.status}\nResponse: ${responseText}`, 
                        'error'
                    );
                }
            } catch (error) {
                if (error.message.includes('CORS') || error.message.includes('network')) {
                    updateResult('token-result', 
                        `üöß CORS Error Detected!\n\nThis is expected when testing from localhost.\n\nSolutions:\n1. Deploy to a real domain (Vercel, Netlify)\n2. Use server-side proxy\n3. Test with procedural generation\n\nYour token format appears correct: ${TOKEN.substring(0, 10)}...\n\nError: ${error.message}`, 
                        'warning'
                    );
                } else {
                    updateResult('token-result', 
                        `‚ùå Network error during token test:\n${error.message}`, 
                        'error'
                    );
                }
            }
        }
        
        async function testShapeE() {
            await testEndpoint('shapeE', 'https://api-inference.huggingface.co/models/openai/shap-e');
        }
        
        async function testPointE() {
            await testEndpoint('pointE', 'https://api-inference.huggingface.co/models/openai/point-e');
        }
        
        async function testStableDiffusion() {
            await testEndpoint('stableDiffusion', 'https://api-inference.huggingface.co/models/stabilityai/stable-diffusion-2');
        }
        
        async function testEndpoint(name, url) {
            updateResult('api-result', `Testing ${name} endpoint: ${url}...`, 'info');
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        inputs: 'test cube',
                        options: { wait_for_model: true }
                    })
                });
                
                const responseHeaders = {};
                for (let [key, value] of response.headers.entries()) {
                    responseHeaders[key] = value;
                }
                
                let result = `${name.toUpperCase()} Test Results:\n`;
                result += `Status: ${response.status} ${response.statusText}\n`;
                result += `Headers: ${JSON.stringify(responseHeaders, null, 2)}\n\n`;
                
                if (response.ok) {
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        const data = await response.json();
                        result += `‚úÖ Success! Response:\n${JSON.stringify(data, null, 2)}`;
                    } else {
                        result += `‚úÖ Success! Binary response received (${contentType})`;
                    }
                    updateResult('api-result', result, 'success');
                } else if (response.status === 503) {
                    const errorText = await response.text();
                    result += `‚è≥ Model is loading:\n${errorText}`;
                    updateResult('api-result', result, 'warning');
                } else {
                    const errorText = await response.text();
                    result += `‚ùå Error:\n${errorText}`;
                    updateResult('api-result', result, 'error');
                }
            } catch (error) {
                updateResult('api-result', 
                    `‚ùå Network error testing ${name}:\n${error.message}`, 
                    'error'
                );
            }
        }
        
        async function checkModelStatus() {
            updateResult('status-result', 'Checking model availability...', 'info');
            
            const models = [
                'openai/shap-e',
                'openai/point-e',
                'stabilityai/stable-diffusion-2'
            ];
            
            let results = [];
            
            for (const model of models) {
                try {
                    const response = await fetch(`https://api-inference.huggingface.co/models/${model}`, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${TOKEN}`
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        results.push(`‚úÖ ${model}: Available`);
                        results.push(`   Downloads: ${data.downloads || 'N/A'}`);
                        results.push(`   Updated: ${data.lastModified || 'N/A'}`);
                    } else {
                        results.push(`‚ùå ${model}: Status ${response.status}`);
                    }
                } catch (error) {
                    results.push(`‚ùå ${model}: Error - ${error.message}`);
                }
                results.push(''); // Empty line
            }
            
            updateResult('status-result', results.join('\n'), 'info');
        }
        
        async function testGeneration() {
            updateResult('generation-result', 'Testing actual generation...', 'info');
            
            try {
                // Try Point-E first as it's simpler
                const response = await fetch('https://api-inference.huggingface.co/models/openai/point-e', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        inputs: 'a simple red cube',
                        options: { 
                            wait_for_model: true,
                            use_cache: false
                        }
                    })
                });
                
                let result = `Generation Test Results:\n`;
                result += `Status: ${response.status}\n`;
                result += `Content-Type: ${response.headers.get('content-type')}\n\n`;
                
                if (response.ok) {
                    const blob = await response.blob();
                    result += `‚úÖ Generation successful!\n`;
                    result += `Response size: ${blob.size} bytes\n`;
                    result += `Type: ${blob.type}\n`;
                    result += `üéâ Your token can generate 3D models!`;
                    updateResult('generation-result', result, 'success');
                } else if (response.status === 503) {
                    const errorText = await response.text();
                    result += `‚è≥ Model is still loading...\n${errorText}\n\n`;
                    result += `This is normal! Try again in 1-2 minutes.`;
                    updateResult('generation-result', result, 'warning');
                } else {
                    const errorText = await response.text();
                    result += `‚ùå Generation failed:\n${errorText}`;
                    updateResult('generation-result', result, 'error');
                }
            } catch (error) {
                updateResult('generation-result', 
                    `‚ùå Generation error:\n${error.message}`, 
                    'error'
                );
            }
        }
        
        async function testCORS() {
            updateResult('cors-result', 'Testing CORS policies...', 'info');
            
            let results = [];
            results.push('CORS Test Results:\n');
            
            // Test if we can make basic requests
            try {
                const response = await fetch('https://huggingface.co/api/whoami', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${TOKEN}`
                    }
                });
                
                results.push('‚úÖ Basic API access: Working');
                results.push(`   Status: ${response.status}`);
                
                // Check CORS headers
                const corsHeaders = {};
                ['access-control-allow-origin', 'access-control-allow-methods', 'access-control-allow-headers'].forEach(header => {
                    const value = response.headers.get(header);
                    if (value) corsHeaders[header] = value;
                });
                
                if (Object.keys(corsHeaders).length > 0) {
                    results.push('\n‚úÖ CORS Headers found:');
                    results.push(JSON.stringify(corsHeaders, null, 2));
                } else {
                    results.push('\n‚ö†Ô∏è No CORS headers detected');
                }
                
            } catch (error) {
                results.push('‚ùå Basic API access: Failed');
                results.push(`   Error: ${error.message}`);
                
                if (error.message.includes('CORS')) {
                    results.push('\nüîß CORS Issue Detected!');
                    results.push('Solutions:');
                    results.push('1. Use a CORS proxy');
                    results.push('2. Run from a proper web server');
                    results.push('3. Use server-side proxy');
                }
            }
            
            updateResult('cors-result', results.join('\n'), 'info');
        }
        
        // Auto-run token test on page load
        window.addEventListener('load', () => {
            setTimeout(testToken, 1000);
        });
    </script>
</body>
</html>
